<th:block th:fragment="postBlog(posts,displayType,shortDate)">
  <li th:each="post : ${posts}" th:attr="id=|post-${post.metadata.name}|">
    <div class="overflow-hidden rounded-2xl border border-white/20 backdrop-blur-sm transition-all duration-300 ease-out hover:-translate-y-2">
      <div class="relative h-72 sm:h-80">
        <th:block th:if="${not #strings.isEmpty(post.spec.cover)}">
          <img
            alt="images"
            class="absolute inset-0 h-full w-full object-cover opacity-0 transition-opacity duration-500"
            loading="lazy"
            sizes="(max-width: 1600px) 100vw, 1600px"
            src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
            th:src="${post.spec.cover}"
            th:alt="${post.spec.title}"
            th:attr="data-src=${post.spec.cover},
                               srcset=|${thumbnail.gen(post.spec.cover, 's')} 400w, ${thumbnail.gen(post.spec.cover, 'm')} 800w, ${thumbnail.gen(post.spec.cover, 'l')} 1200w|"
          />
        </th:block>
        <th:block th:if="${#strings.isEmpty(post.spec.cover)}">
          <img
            alt="images"
            class="absolute inset-0 h-full w-full object-cover opacity-0 transition-opacity duration-500"
            loading="lazy"
            src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
            th:src="${#theme.assets('/images/blog.avif')}"
            th:attr="data-src=${#theme.assets('/images/blog.avif')}"
            th:alt="${post.spec.title}"
          />
        </th:block>
        <div class="absolute inset-0 bg-linear-to-t from-black/80 via-black/30 to-black/20"></div>
        <div class="absolute top-4 left-4 flex justify-center space-x-2" th:if="${displayType == 'allCategories'}">
          <a
            class="rounded-xl border border-white/30 bg-white/20 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm md:px-3 md:text-sm"
            href=""
            th:each="categories : ${post.categories}"
            th:href="@{${categories.status.permalink}}"
            th:text="${categories.spec.displayName}"
            th:title="|#{page.post.categories}| + ':' +  |${categories.spec.displayName}|"
          ></a>
        </div>
        <div class="absolute top-4 left-4 flex justify-center space-x-2" th:if="${displayType == 'currentTag'}">
          <a
            class="rounded-xl border border-white/30 bg-white/20 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm md:px-3 md:text-sm"
            th:href="@{${tag.status.permalink}}"
            th:text="${tag.spec.displayName}"
            th:title="|#{page.post.tags}| + ':' + |${tag.spec.displayName}|"
          ></a>
        </div>
        <div class="absolute top-4 left-4 flex justify-center space-x-2" th:if="${displayType == 'currentCategory'}">
          <a
            class="rounded-xl border border-white/30 bg-white/20 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm md:px-3 md:text-sm"
            th:href="@{${category.status.permalink}}"
            th:text="${category.spec.displayName}"
            th:title="|#{page.post.categories}| + ':' +  |${categories.spec.displayName}|"
          ></a>
        </div>
        <div class="absolute top-1 right-4 rounded-full p-1.5 md:p-2" th:title="#{fragment.postCard.pinned}" th:if="${post.spec.pinned}">
          <i class="fas fa-location-pin text-xs text-gray-400 md:text-xl"></i>
        </div>
        <div class="absolute right-0 bottom-0 left-0 p-3 md:p-4">
          <div class="flex items-center space-x-5" th:classappend="${theme.config.index_blog.blog_items.b_card != true ? 'mb-3' : 'mb-2'}">
            <div class="flex items-center space-x-2">
              <img alt="" class="h-6 w-6 rounded-full object-cover ring-2 ring-white/20" th:src="${post.owner.avatar}" />
              <span class="text-xs text-white md:text-sm" th:text="${post.owner.displayName}"></span>
            </div>
            <div class="flex items-center space-x-1 text-xs text-white/80 md:text-sm">
              <i class="fas fa-calendar-day text-white/60"></i>
              <span
                th:if="${shortDate == null || !shortDate}"
                th:text="${#locale.language == 'zh'} ? |#{page.archives.date_zh(${#dates.format(post.spec.publishTime,'dd')},${#dates.format(post.spec.publishTime,'MM')},${#dates.format(post.spec.publishTime,'yyyy')})}| : |#{page.archives.date(${#dates.format(post.spec.publishTime,'dd')},${#dates.format(post.spec.publishTime,'MMM')},${#dates.format(post.spec.publishTime,'yyyy')})}|"
              ></span>
              <span
                th:if="${shortDate != null && shortDate}"
                th:text="${#locale.language == 'zh'} ? |#{page.archives.date_short(${#dates.format(post.spec.publishTime,'dd') + 'æ—¥'},${#dates.format(post.spec.publishTime,'MMM')})}| : |#{page.archives.date_short(${#dates.format(post.spec.publishTime,'dd')},${#dates.format(post.spec.publishTime,'MMM') + ','})}|"
              ></span>
            </div>
          </div>
          <h2
            class="mb-3 text-lg leading-tight font-bold text-white drop-shadow-lg md:text-2xl"
            th:classappend="${theme.config.index_blog.blog_items.b_card == true ? 'md:hidden' : ''}"
          >
            <a th:href="@{${post.status.permalink}}" th:text="${post.spec.title}"></a>
          </h2>
          <a aria-label="read" class="overflow-hidden transition-all duration-500 ease-in-out" th:href="@{${post.status.permalink}}">
            <p
              class="line-clamp-3 text-sm leading-relaxed text-white md:text-base"
              th:classappend="${(theme.config.index_blog.blog.blog_enabled == 'one' ? 'sm:line-clamp-2' : (theme.config.index_blog.blog.blog_enabled == 'two' ? 'sm:line-clamp-2' : '')) + (theme.config.index_blog.blog_items.b_card != true ? ' md:mb-3' : ' md:mb-2')}"
              th:text="${post.status.excerpt}"
            ></p>
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-3 text-xs text-white/80 md:space-x-4 md:text-sm">
                <div class="flex items-center space-x-1 rounded-full bg-white/10 px-2 py-1 backdrop-blur-sm">
                  <i class="fas fa-eye"></i>
                  <span th:text="|${post.stats?.visit ?:0}|"></span>
                </div>
                <div class="flex items-center space-x-1 rounded-full bg-white/10 px-2 py-1 backdrop-blur-sm">
                  <i class="fas fa-comment"></i>
                  <span th:text="|${post.stats?.comment ?:0}|"></span>
                </div>
                <div class="flex items-center space-x-1 rounded-full bg-white/10 px-2 py-1 backdrop-blur-sm">
                  <i class="fas fa-heart"></i>
                  <span th:text="|${post.stats?.upvote ?:0}|"></span>
                </div>
              </div>
              <button class="cursor-pointer p-2 text-xs font-medium text-white transition-colors hover:text-blue-300 md:text-sm">
                <a
                  aria-label="read"
                  class="group inline-flex items-center space-x-2 rounded-full bg-white/20 px-4 py-2 text-xs font-medium text-white backdrop-blur-sm transition-all duration-300 hover:scale-105 hover:bg-white/30 hover:shadow-lg md:text-sm"
                  th:href="@{${post.status.permalink}}"
                >
                  <span th:text="#{widget.index.module.readMore}"></span>
                  <i class="fas fa-arrow-right transition-transform duration-300 group-hover:translate-x-1"></i>
                </a>
              </button>
            </div>
          </a>
        </div>
      </div>
    </div>
  </li>
</th:block>

<th:block th:fragment="pagination(pagination)">
  <nav class="mt-8 flex items-center justify-center gap-6">
    <a
      th:href="${pagination.hasPrevious() ? pagination.prevUrl : 'javascript:void(0)'}"
      th:classappend="${!pagination.hasPrevious() ? 'opacity-50 cursor-not-allowed' : ''}"
      class="inline-flex items-center justify-center rounded-xl bg-white px-6 py-3 text-sm font-medium text-gray-900 shadow-sm transition-all dark:bg-white/10 dark:text-white/70"
    >
      <i class="fas fa-chevron-left mr-2"></i>
      <span th:text="#{common.previous}"></span>
    </a>
    <div class="inline-flex items-center gap-1 rounded-xl bg-white px-4 py-3 shadow-sm dark:bg-white/10">
      <span class="text-sm font-bold text-gray-900 dark:text-white" th:text="${pagination.page}"></span>
      <span class="text-xs text-gray-400 dark:text-gray-500">/</span>
      <span class="text-sm text-gray-500 dark:text-gray-400" th:text="${pagination.totalPages}"></span>
    </div>
    <a
      th:href="${pagination.hasNext() ? pagination.nextUrl : 'javascript:void(0)'}"
      th:classappend="${!pagination.hasNext() ? 'opacity-50 cursor-not-allowed' : ''}"
      class="inline-flex items-center justify-center rounded-xl bg-white px-6 py-3 text-sm font-medium text-gray-900 shadow-sm transition-all dark:bg-white/10 dark:text-white/70"
    >
      <span th:text="#{common.next}"></span>
      <i class="fas fa-chevron-right ml-2"></i>
    </a>
  </nav>
</th:block>

<th:block th:fragment="categoryCard(cat)">
  <li class="group space-y-3 overflow-hidden rounded-2xl bg-gray-400/5 p-4 backdrop-blur-sm transition-all duration-300 ease-out hover:-translate-y-2 dark:bg-white/5">
    <div class="flex items-center justify-between">
      <div th:with="fontIcon=${#annotations.getOrDefault(cat, 'font', '')},colorClass = ${#annotations.getOrDefault(cat, 'color', '')}" class="flex items-center">
        <div th:if="${not #strings.isEmpty(fontIcon)}" th:utext="${fontIcon}" class="size-4"></div>
        <i
          th:if="${#strings.isEmpty(fontIcon)}"
          class="fas fa-folder-open"
          th:classappend="${not #strings.isEmpty(colorClass) ? colorClass : 'text-gray-500'}"
          th:style="${not #strings.isEmpty(colorClass) ? 'background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;' : ''}"
        ></i>
        <span class="ml-1 text-sm font-medium" th:text="${cat.spec.displayName}"></span>
      </div>
      <div class="flex items-center space-x-0.5 text-xs text-gray-500 dark:text-gray-400">
        <i class="fas fa-file-alt text-gray-400 dark:text-gray-500"></i>
        <span th:text="${cat.status?.visiblePostCount ?: 0} + ' ' + #{page.archives.title.post}"></span>
      </div>
    </div>
    <p class="line-clamp-1 text-sm text-gray-500" th:if="${!#strings.isEmpty(cat.spec.description)}" th:text="${cat.spec.description}"></p>
    <p class="line-clamp-1 text-sm text-gray-500" th:unless="${!#strings.isEmpty(cat.spec.description)}" th:text="#{page.categories.other}"></p>
    <div class="rounded-md bg-gray-50/80 p-2 dark:bg-white/5" th:with="posts = ${postFinder.listByCategory(1,1,'__${cat.metadata.name}__')}">
      <dl class="text-gray-500 dark:text-gray-400" th:each="post : ${posts.items}" th:if="${postStat.index == 0}">
        <dt class="flex items-center space-x-0.5 text-xs">
          <i class="fas fa-clock"></i>
          <span
            class="text-xs"
            th:if="${#locale.language == 'zh'}"
            th:text="#{page.archives.date_zh(${#dates.format(post.spec.publishTime,'dd')},${#dates.format(post.spec.publishTime,'MM')},${#dates.format(post.spec.publishTime,'yy')})}"
          ></span>
          <span
            class="text-xs"
            th:if="${#locale.language != 'zh'}"
            th:text="#{page.archives.date(${#dates.format(post.spec.publishTime,'dd')},${#dates.format(post.spec.publishTime,'MMM')},${#dates.format(post.spec.publishTime,'yyyy')})}"
          ></span>
        </dt>
        <dd class="text-xs">
          <a
            class="flex items-center justify-between transition duration-300 group-hover:text-black dark:group-hover:text-white"
            th:href="@{${cat.status.permalink}}"
          >
            <span class="text-sm font-medium" th:text="${post.spec.title}"></span>
            <div>
              <span th:text="#{page.categories.morePosts}"></span>
              <i class="fas fa-arrow-right"></i>
            </div>
          </a>
        </dd>
      </dl>
      <div class="text-xs text-gray-500 dark:text-gray-400" th:if="${#lists.isEmpty(posts.items)}">
        <dt class="flex items-center space-x-0.5 text-xs">
          <i class="fas fa-clock"></i>
          <span class="text-xs" th:text="#{page.categories.empty}"></span>
        </dt>
        <dd class="text-xs">
          <a
            class="flex items-center justify-between transition duration-300 group-hover:text-black dark:group-hover:text-white"
            th:href="@{${cat.status.permalink}}"
          >
            <span class="text-sm font-medium" th:text="#{page.categories.null}"></span>
            <div>
              <span th:text="#{page.categories.morePosts}"></span>
              <i class="fas fa-arrow-right"></i>
            </div>
          </a>
        </dd>
      </div>
    </div>
  </li>
</th:block>
