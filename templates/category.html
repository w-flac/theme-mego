<!doctype html>
<html
  th:replace="~{modules/layout :: html(title = |${category.spec.displayName} - ${site.title}|, content = ~{::content}, head = null, footer = null, sidebar = ~{::sidebar}, contentClass = '')}"
  xmlns:th="https://www.thymeleaf.org"
>
  <th:block th:fragment="content">
    <th:block th:replace="~{modules/header}" />
    <!--  Category Title  -->
    <div class="mt-16 bg-gray-400/5 px-4 py-12 sm:px-6 sm:py-16 lg:px-8 dark:bg-white/5" th:attr="id=|items-${category.metadata.name}|">
      <div class="mx-auto max-w-3xl">
        <div class="mb-4 flex flex-col items-center justify-center sm:mb-6">
          <th:block th:with="fontIcon = ${#annotations.getOrDefault(category, 'font', '')},colorClass = ${#annotations.getOrDefault(category, 'color', '')}">
            <div
              class="mb-3 flex h-12 w-12 flex-col items-center justify-center rounded-xl p-4 shadow-lg sm:mb-4 sm:h-16 sm:w-16 sm:rounded-2xl"
              th:classappend="${not #strings.isEmpty(colorClass) ? colorClass : 'bg-gray-500'}"
            >
              <div th:if="${not #strings.isEmpty(fontIcon)}" th:utext="${fontIcon}" class="size-[2rem]"></div>
              <i th:unless="${not #strings.isEmpty(fontIcon)}" class="fas fa-folder-open text-2xl text-white"></i>
            </div>
          </th:block>

          <h3 class="text-2xl font-bold text-gray-900/70 sm:text-3xl dark:text-white/70" th:text="${category.spec.displayName}"></h3>
        </div>
        <div class="mx-auto mb-6 px-4 sm:mb-8">
          <p class="text-center text-sm leading-relaxed text-gray-600 sm:text-base dark:text-gray-300" th:text="${category.spec.description}"></p>
        </div>
        <div class="flex items-center justify-center space-x-4 text-xs text-gray-500 sm:flex-row sm:text-sm lg:space-x-8 dark:text-gray-400">
          <div class="flex items-center">
            <i class="fas fa-file-alt mr-2"></i>
            <span th:text="|${category.postCount != null ? category.postCount : 0} | + |#{page.archives.title.post}| "></span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-eye mr-2"></i>
            <span id="category-visit"></span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-calendar mr-2"></i>
            <span
              class="inline"
              th:if="${#locale.language == 'zh'}"
              th:text="#{page.archives.date_zh2(${#dates.format(category.metadata.creationTimestamp,'dd')},${#dates.format(category.metadata.creationTimestamp,'MM')},${#dates.format(category.metadata.creationTimestamp,'yyyy')})}"
            ></span>
            <span
              class="inline"
              th:if="${#locale.language != 'zh'}"
              th:text="#{page.archives.date(${#dates.format(category.metadata.creationTimestamp,'dd')},${#dates.format(category.metadata.creationTimestamp,'MMM')},${#dates.format(category.metadata.creationTimestamp,'yyyy')})}"
            ></span>
          </div>
        </div>
      </div>
    </div>
    <!--  Category  -->
    <section class="mx-auto max-w-6xl px-2 py-8 md:px-0">
      <div class="relative grid grid-cols-1 gap-8" th:classappend="${posts.total == 0 ? '' : 'lg:grid-cols-4'}">
        <ul class="category-post col-span-full space-y-8" th:classappend="${posts.total == 0 ? '' : 'lg:col-span-3'}">
          <th:block th:replace="~{modules/module :: postBlog(posts = ${posts.items}, displayType = 'currentCategory', shortDate = false)}"></th:block>
          <li class="flex flex-col items-center justify-center py-12 text-center text-gray-500 lg:mt-10 lg:min-h-96" th:if="${posts.total == 0}">
            <svg class="mb-3 h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                d="M9 13h6m-6 4h6m-7 4h8a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-3.5l-1-2h-3l-1 2H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
              />
            </svg>
            <p class="text-lg font-medium" th:text="#{page.categories.error}"></p>
            <button
              class="mt-4 inline-flex items-center rounded-lg border border-gray-200/80 bg-gray-50/80 px-4 py-2 text-sm font-medium text-gray-700 transition-all duration-300 hover:bg-gray-100 hover:shadow-lg dark:border-transparent dark:bg-white/5 dark:text-gray-300 dark:hover:bg-white/10"
              onclick="history.back()"
            >
              <i class="fa-solid fa-rotate-left mr-2"></i>
              <span th:text="#{page.error.back}"></span>
            </button>
          </li>
          <th:block th:if="${posts.hasNext()}">
            <li class="mt-8 text-center" id="load-more-container"></li>
          </th:block>
        </ul>
        <!--  Category Aside  -->
        <div class="hidden lg:col-span-1 lg:block" th:if="${posts.total > 0}">
          <div class="sticky top-24 space-y-6 self-start">
            <ul class="overflow-hidden rounded-2xl border border-gray-200/70 bg-gray-400/5 p-6 backdrop-blur-sm dark:border-white/20 dark:bg-white/5">
              <th:block th:with="categories = ${categoryFinder.listAll()}">
                <li class="space-y-3">
                  <a
                    class="group relative flex items-center space-x-4 overflow-hidden rounded-xl border border-gray-200/80 bg-gray-50/80 p-4 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg dark:border-transparent dark:bg-white/5"
                    th:each="category : ${categories}"
                    th:href="@{${category.status.permalink}}"
                  >
                    <th:block th:with="fontIcon = ${#annotations.getOrDefault(category, 'font', '')},colorClass = ${#annotations.getOrDefault(category, 'color', '')}">
                      <div
                        class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg shadow-md"
                        th:classappend="${not #strings.isEmpty(colorClass) ? colorClass : 'bg-gray-500'}"
                      >
                        <div th:if="${not #strings.isEmpty(fontIcon)}" th:utext="${fontIcon}" class="size-5"></div>
                        <i th:unless="${not #strings.isEmpty(fontIcon)}" class="fas fa-folder-open text-base text-white"></i>
                      </div>
                    </th:block>

                    <div class="flex-1 shrink-0">
                      <p class="font-semibold text-gray-900 dark:text-white" th:text="${category.spec.displayName}"></p>
                      <span class="text-sm text-gray-500 dark:text-gray-400" th:text="${category.status?.visiblePostCount ?: 0} + ' ' + #{page.archives.title.post}"></span>
                    </div>
                    <div class="hidden opacity-0 transition-opacity group-hover:opacity-100 xl:block">
                      <i class="fa-solid fa-person-walking-arrow-right"></i>
                    </div>
                  </a>
                </li>
              </th:block>
            </ul>
          </div>
        </div>
      </div>
    </section>
    <th:block th:replace="~{modules/footer}" />
    <script th:inline="javascript">
      const categoryViewCount = new CategoryViewCount({
        readLabel: /*[[#{page.categoryView.readLabel}]]*/ "",
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        categoryViewCount.init();
      });
    </script>
  </th:block>
</html>
